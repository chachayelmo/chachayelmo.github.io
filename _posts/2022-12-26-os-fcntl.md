---
published: true
title:  "[Programming] fcntl"
excerpt: "fcntl ì˜ ê¸°ì´ˆ ê°œë… ë° ì‚¬ìš©ë°©ë²•"

categories:
  - OS
tags:
  - [Programming, Linux, Fcntl]

toc: true
toc_sticky: true
 
date: 2022-12-26
last_modified_at: 2022-12-26
---

## 1. fcntlì´ë€?
- ì´ë¯¸ ì—´ë ¤ìˆëŠ” íŒŒì¼ì˜ íŠ¹ì„± ì œì–´ë¥¼ ìœ„í•´ì„œ ì‚¬ìš©

```cpp
#include <unistd.h>
#include <fcntl.h>

int fcntl(int fd, int cmd);
int fcntl(int fd, int cmd, long arg);
int fcntl(int fd, int cmd, struct flock *lock);
```

- ì²«ë²ˆì§¸ ì¸ìë¡œ ì£¼ì–´ì§€ëŠ” fdëŠ” open(), socket() ë“±ì˜ ì‹œìŠ¤í…œ í˜¸ì¶œì„ í†µí•´ì„œ ë§Œë“¤ì–´ì§„ íŒŒì¼ì§€ì •ì
- ë‘ë²ˆì§¸ ì¸ìì¸ cmdê°€ fdì— ëŒ€í•œ íŠ¹ì„±ì„ ì œì–´í•˜ê¸° ìœ„í•œ ê°’

## 2. íŠ¹ì„± ì œì–´ë¥¼ ìœ„í•œ cmd ì¢…ë¥˜
1. F_DUPFD
  - fdë¥¼ ë³µì‚¬í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©
  - ìƒˆë¡œìš´ fdë¥¼ ë°˜í™˜ê°’ìœ¼ë¡œ ëŒë ¤ì¤Œ, ì´ë•Œ close-on-execëŠ” ê³µìœ í•˜ì§€ ì•ŠìŒ
2. F_DUPFD_CLOEXEC
  - fdë¥¼ ë³µì‚¬í•˜ê³  ìƒˆë¡œìš´ fdì— ê´€ë ¨ëœ FD_CLOEXECë¥¼ ì„¤ì •, ìƒˆë¡œìš´ fdê°€ ë°˜í™˜ë¨
3. F_GETFD
  - ë¦¬í„´ ê°’ìœ¼ë¡œ fdì— ëŒ€í•œ flag ê°’(FD_CLOEXEC)ì„ ë„˜ê²¨ì¤Œ
4. F_SETFD
  - FD_CLOEXECì˜ ê°’ì„ ì§€ì •ëœ ë¹„íŠ¸ê°’ìœ¼ë¡œ ì„¤ì •
5. F_GETFL
  - fdì— ëŒ€í•œ íŒŒì¼ ìƒíƒœ ì†ì„±ë“¤ì˜ ë°˜í™˜ê°’ì„ ëŒë ¤ì¤Œ
  - O_RDONLY, O_WRONLY, O_RDWR, O_EXEC, O_SEARCH ëŠ” ê°œë³„ì ìœ¼ë¡œ íŒì •í•  ìˆ˜ ì—†ê³ , ACCMODEë¼ëŠ” ë§ˆìŠ¤í¬ë¥¼ ì´ìš©í•˜ì—¬ ì•Œì•„ ëƒ„
6. F_SETFL
  - íŒŒì¼ ìƒíƒœ ì†ì„±ë“¤ì„ ì„¸ë²ˆì§¸ ì¸ìˆ˜(arg)ë¡œ ë°›ì•„ ì„¤ì •
  - O_APPEND, O_ASYNC, O_DIRECT, O_NOATIME, O_NONBLOCK
7. F_GETOWN
  - ë¹„ë™ê¸° ì…ì¶œë ¥ê³¼ ê´€ë ¨ë˜ì–´ ì‚¬ìš©ë˜ë©°, SIGIOì™€ SIGURG ì‹ í˜¸ë¥¼ ë°›ëŠ” í”„ë¡œì„¸ìŠ¤ idë¥¼ ì–»ê¸° ìœ„í•´ ì‚¬ìš©
8. F_SETOWN
  - ë¹„ë™ê¸° ì…ì¶œë ¥ê³¼ ê´€ë ¨ë˜ì–´ ì‚¬ìš©ë˜ë©°, SIGIOì™€ SIGURG ì‹ í˜¸ë¥¼ ìˆ˜ì‹ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ IDë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ ì‚¬ìš©

- close-on-exec ë€?
  - open-on-exec :
    - ë³´í†µ í”„ë¡œì„¸ìŠ¤ì—ì„œ exec()ë¥¼ ì‹œì¼œì„œ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ê¸°ì¡´ì˜ í”„ë¡œì„¸ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë®ì–´ì“°ê²Œ ë¨
    - ë˜í•œ, íŠ¹ë³„í•œ ì„¤ì •ì´ ì—†ì„ ê²½ìš° ì—´ë¦° fdë¥¼ ê·¸ëŒ€ë¡œ ë„˜ê²¨ì¤Œ
  - close-on-exec :
    - execë¥¼ ì´ìš©í•´ì„œ í”„ë¡œì„¸ìŠ¤ë¥¼ ë§Œë“¤ê¸° ì „ì— ê¸°ì¡´ì— ì—´ë¦° fdë“¤ì„ ì •ë¦¬í•˜ê³  ì‹¶ì„ ë•Œê°€ ìˆëŠ” ê²½ìš°ë¥¼ close-on-exec ì‹œí‚¨ë‹¤ê³  ë§í•¨
    - fcntlì„ ì´ìš©í•´ì„œ ì—´ë¦° fdì— ëŒ€í•´ì„œ close-on-execë¥¼ ì‘ë™í•˜ë„ë¡ ê°€ëŠ¥

## 3. ì†ì„± ì¡°íšŒ, ë³€ê²½

```cpp
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <sys/types.h>

void printAccessMode(int flags){
  switch(flags & O_ACCMODE){
    case O_RDONLY:
      printf("RDONLY\n");
      break;
    case O_WRONLY:
      printf("WRONLY\n");
      break;
    case O_RDWR:
      printf("RDWR\n");
      break;
    }

  printf("append %s \n", (flags & O_APPEND) ? "O":"X");
  printf("nonblocking %s \n", (flags & O_NONBLOCK) ? "O":"X");
  printf("\n");
}

int main(){
  int fd = open("test.txt", O_RDONLY|O_CREAT, 0666);

  int flags = fcntl(fd, F_GETFL, 0);
  printAccessMode(flags);

  // O_APPEND flag ì¶”ê°€
  flags |= O_APPEND;

  // F_SETFL with arg
  fcntl(fd, F_SETFL, flags);
  flags = fcntl(fd, F_GETFL, 0);
  printAccessMode(flags);
}
```

## 4. ë¹„ë™ê¸° ì˜ˆì œ

```cpp
#include <unistd.h>
#include <stdio.h>
#include <fcntl.h>
#include <sys/types.h>

int main(){
  char buf[128] = {0,};
  int fd = 0;
  int flags = fcntl(fd, F_GETFL, 0);

  flags |= O_NONBLOCK;
  fcntl(fd, F_SETFL, flags);

  read(fd, buf, sizeof(buf));
  // ì‚¬ìš©ì ì…ë ¥ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë°”ë¡œ ë²„í¼ë¥¼ ì¶œë ¥í•˜ê³  ëëƒ„
  printf("buf : %s \n", buf); // buf :
}
```

## ì°¸ê³ 
[reakwon](https://reakwon.tistory.com/110)  
[joinc](https://www.joinc.co.kr/w/Site/system_programing/File/Fcntl)

<br>

    This is personal diary for study documents.
    Please comment if I'm wrong or missing something else ğŸ˜„. 

[Top](#){: .btn .btn--primary }{: .align-right}